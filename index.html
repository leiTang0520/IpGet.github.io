<!DOCTYPE html>
<html>
<head>
    <title>IP收集器</title>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>
<body>
    <h1>IP地址收集</h1>
    <div id="info">正在处理...</div>

    <script>
        function trackUser() {
            const infoDiv = document.getElementById('info');
            
            // 创建一个隐藏的iframe来加载HTTP内容
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = `http://223.167.175.180:5000/api/track?timestamp=${encodeURIComponent(new Date().toISOString())}&ua=${encodeURIComponent(navigator.userAgent)}`;
            
            iframe.onload = function() {
                // 同时显示用户IP信息
                fetch('https://api.ipify.org?format=json')
                    .then(response => response.json())
                    .then(data => {
                        infoDiv.innerHTML = `✅ 记录成功！<br>你的IP: <strong>${data.ip}</strong>`;
                    })
                    .catch(() => {
                        infoDiv.innerHTML = '✅ 访问已记录！';
                    });
            };
            
            document.body.appendChild(iframe);
        }

        // 自动执行
        window.onload = trackUser;
    </script>
</body>
</html>
