<!DOCTYPE html>
<html>
<head>
    <title>IP收集器</title>
</head>
<body>
    <h1>IP地址收集</h1>
    <p>你的IP地址正在被记录...</p>
    <div id="info"></div>

    <script>
        // 使用图片像素方式发送数据（不会被混合内容阻止）
        function trackViaPixel() {
            const timestamp = new Date().toISOString();
            const ua = navigator.userAgent;
            
            // 创建跟踪像素
            const img = new Image();
            img.src = `http://223.167.175.180:5000/api/track?timestamp=${encodeURIComponent(timestamp)}&ua=${encodeURIComponent(ua)}`;
            img.style.display = 'none';
            
            document.body.appendChild(img);
            
            // 同时尝试获取并显示IP
            getAndDisplayIP();
        }
        
        function getAndDisplayIP() {
            // 使用JSONP获取IP用于显示（不发送到服务器）
            window.displayIPCallback = function(data) {
                document.getElementById('info').innerHTML = 
                    `你的IP地址: <strong>${data.ip}</strong><br>
                     时间: ${new Date().toLocaleString()}<br>
                     <small>IP已通过像素跟踪记录到服务器</small>`;
            };
            
            const script = document.createElement('script');
            script.src = 'https://api.ipify.org?format=jsonp&callback=displayIPCallback';
            document.head.appendChild(script);
        }
        
        // 页面加载时自动执行
        window.onload = trackViaPixel;
    </script>
</body>
</html>
